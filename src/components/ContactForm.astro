<div class="max-w-4xl mx-auto py-10">
  <p class="text-slate-600 text-lg mb-8 text-center">
    お問い合わせは以下のフォームからお願いいたします。<br>
    内容を確認次第、ご連絡させていただきます。
  </p>
  <div class="max-w-2xl mx-auto">
    <form id="contact-form" class="space-y-6">
      <div class="space-y-2">
        <label for="name" class="block text-slate-700 font-medium">お名前 <span class="text-red-500">*</span></label>
        <input type="text" id="name" name="name" required class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-colors duration-200" placeholder="山田 太郎">
      </div>
      <div class="space-y-2">
        <label for="email" class="block text-slate-700 font-medium">メールアドレス <span class="text-red-500">*</span></label>
        <input type="email" id="email" name="email" required class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-colors duration-200" placeholder="example@email.com">
      </div>
      <div class="space-y-2">
        <label for="company" class="block text-slate-700 font-medium">会社名・団体名</label>
        <input type="text" id="company" name="company" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-colors duration-200" placeholder="株式会社〇〇">
      </div>
      <div class="space-y-2">
        <label for="message" class="block text-slate-700 font-medium">お問い合わせ内容 <span class="text-red-500">*</span></label>
        <textarea id="message" name="message" required rows="6" class="w-full px-4 py-3 rounded-lg border border-slate-300 focus:border-amber-500 focus:ring-2 focus:ring-amber-200 transition-colors duration-200 resize-none" placeholder="お問い合わせ内容をご記入ください"></textarea>
      </div>
      <div class="text-center pt-4">
        <button type="submit" id="submit-button" class="inline-flex items-center gap-2 rounded-full border-2 border-slate-400 hover:border-slate-500 text-slate-400 hover:text-slate-500 px-4 py-2 text-base font-normal hover:-translate-y-0.5 hover:shadow-lg transition">
          <i class="fas fa-paper-plane" id="submit-icon"></i>
          <span class="ml-3" id="submit-text">送信する</span>
        </button>
      </div>
    </form>

    <div id="submit-success" class="mt-6 hidden">
      <div class="bg-white rounded-2xl p-8 text-center">
        <div class="flex flex-col items-center justify-center">
          <div class="w-16 h-16 bg-teal-100 rounded-full flex items-center justify-center mb-4">
            <i class="fas fa-check-circle text-3xl text-teal-600"></i>
          </div>
          <h3 class="text-xl font-bold text-teal-800 mb-2">送信が完了しました</h3>
          <p class="text-teal-700 mb-4 max-w-md mx-auto">内容を確認次第、ご連絡させていただきます。</p>
        </div>
      </div>
    </div>

    <div id="submit-error" class="mt-6 hidden">
      <div class="bg-white rounded-2xl p-8 shadow-lg text-center">
        <div class="flex flex-col items-center justify-center">
          <div class="w-16 h-16 bg-rose-100 rounded-full flex items-center justify-center mb-4">
            <i class="fas fa-exclamation-circle text-3xl text-rose-600"></i>
          </div>
          <h3 class="text-xl font-bold text-rose-800 mb-2">送信に失敗しました</h3>
          <p class="text-rose-700 mb-4 max-w-md mx-auto">以下のメールアドレスまで直接ご連絡ください：</p>
          <div class="flex flex-col items-center gap-4">
            <a id="mailto-link" href="mailto:contact@meggumi.com" class="text-rose-600 hover:text-rose-700 font-mono bg-rose-50 px-4 py-2 rounded-lg border border-rose-200 transition-colors duration-200">contact@meggumi.com</a>
            <button id="copy-button" class="text-rose-600 hover:text-rose-700 font-mono bg-rose-50 px-4 py-2 rounded-lg border border-rose-200 transition-colors duration-200 flex items-center gap-2">
              <i class="fas fa-copy"></i>
              <span>問い合わせ内容をコピー</span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const config = {
    contact: { email: 'contact@meggumi.com', companyName: 'meg+gumi', responseTime: '3営業日以内' },
    form: {
      googleFormUrl: 'https://docs.google.com/forms/d/e/1FAIpQLScRbLHC6JTR_1mkMqoLNoIzR1Y5pLZ_SrAo-cUReewnh5bQmw/formResponse',
      entryIds: { name: 'entry.180285880', email: 'entry.1686666147', company: 'entry.626095155', message: 'entry.668514380' }
    }
  }

  const form = document.getElementById('contact-form')
  const btn = document.getElementById('submit-button')
  const btnIcon = document.getElementById('submit-icon')
  const btnText = document.getElementById('submit-text')
  const successEl = document.getElementById('submit-success')
  const errorEl = document.getElementById('submit-error')
  const mailtoLink = document.getElementById('mailto-link')
  const copyButton = document.getElementById('copy-button')

  const setSubmitting = (submitting) => {
    if (submitting) {
      btn.disabled = true
      btnIcon.className = 'fas fa-spinner fa-spin'
      btnText.textContent = '送信中...'
    } else {
      btn.disabled = false
      btnIcon.className = 'fas fa-paper-plane'
      btnText.textContent = '送信する'
    }
  }

  const buildMailto = (data) => {
    const subject = encodeURIComponent('お問い合わせ')
    const body = encodeURIComponent(
      `お名前：${data.name}\nメールアドレス：${data.email}\n会社名・団体名：${data.company || ''}\n\nお問い合わせ内容：\n${data.message}`
    )
    return `mailto:${config.contact.email}?subject=${subject}&body=${body}`
  }

  copyButton?.addEventListener('click', () => {
    const data = Object.fromEntries(new FormData(form).entries())
    const content = `お名前：${data.name}\nメールアドレス：${data.email}\n会社名・団体名：${data.company || ''}\n\nお問い合わせ内容：\n${data.message}\n\n※上記の内容を以下のメールアドレスに送信してください：\n${config.contact.email}`
    navigator.clipboard.writeText(content).then(() => alert('問い合わせ内容をコピーしました')).catch(console.error)
  })

  form?.addEventListener('submit', async (e) => {
    e.preventDefault()
    setSubmitting(true)
    try {
      const fd = new FormData(form)
      const mapped = new FormData()
      mapped.append(config.form.entryIds.name, fd.get('name'))
      mapped.append(config.form.entryIds.email, fd.get('email'))
      mapped.append(config.form.entryIds.company, fd.get('company'))
      mapped.append(config.form.entryIds.message, fd.get('message'))

      await fetch(config.form.googleFormUrl, { method: 'POST', body: mapped, mode: 'no-cors' })

      form.classList.add('hidden')
      successEl.classList.remove('hidden')
      form.reset()
    } catch (err) {
      console.error('送信エラー:', err)
      form.classList.add('hidden')
      errorEl.classList.remove('hidden')
      const data = Object.fromEntries(new FormData(form).entries())
      mailtoLink.href = buildMailto(data)
    } finally {
      setSubmitting(false)
    }
  })
</script>

